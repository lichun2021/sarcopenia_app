# 3D热力图功能使用说明

## 🚀 功能概述

新增的3D热力图功能为肌少症检测系统提供了更直观的压力数据可视化方式，支持2D/3D模式无缝切换，采用独立线程渲染确保UI响应性。

## ✨ 主要特性

### 🔄 双模式显示
- **2D模式**: 传统热力图，高性能实时渲染
- **3D模式**: 立体热力图，俯视角度+轻微向上倾斜

### ⚡ 性能优化
- **独立渲染线程**: 3D渲染不阻塞主UI线程
- **帧率控制**: 可配置目标FPS（默认15帧）
- **智能队列管理**: 自动丢弃过期帧，避免延迟积压
- **内存管理**: 及时释放图形资源，防止内存泄漏

### 🎮 交互控制
- **一键切换**: 2D/3D模式随时切换
- **视角预设**: 俯视、侧视、斜视角度快速切换
- **实时状态**: 显示FPS、丢帧数等性能指标

## 🎯 使用方法

### 启动系统
```bash
# 在Windows环境下运行（需要图形界面）
python run_detection_system.py

# 或使用批处理文件
启动UI.bat
```

### 界面操作

#### 1. 模式切换
- 点击 **"2D热力图"** 单选按钮切换到2D模式
- 点击 **"3D热力图"** 单选按钮切换到3D模式

#### 2. 3D视角控制
- **俯视**: 15°仰角，45°方位角（默认，轻微向上倾斜）
- **侧视**: 45°仰角，0°方位角
- **斜视**: 30°仰角，45°方位角

#### 3. 性能监控
- 状态栏显示当前模式和性能信息
- 3D模式显示实际FPS和帧计数

## ⚙️ 技术参数

### 3D渲染配置
```python
目标FPS: 15帧/秒
渲染队列: 最大2帧
俯视角度: 15°仰角 + 45°方位角
颜色映射: 8级渐变（白色→深红）
压力范围: 0-255 → 0-60mmHg
```

### 线程架构
```
主UI线程 → 数据接收 → 队列传递 → 3D渲染线程 → 结果队列 → UI显示更新
```

## 🔧 文件结构

### 新增文件
- `visualization_3d.py` - 3D热力图核心模块
- `test_3d_heatmap.py` - 功能测试脚本
- `3D热力图使用说明.md` - 本使用说明

### 修改文件
- `pressure_sensor_ui.py` - 集成3D可视化器
  - 导入 `EnhancedHeatmapVisualizer`
  - 增加资源清理逻辑

## 🧪 测试方法

### 1. 功能测试
```bash
python test_3d_heatmap.py
```

### 2. 测试功能
- 动态数据模拟（波纹+高斯峰+边缘效应）
- 数组大小切换（32x32, 32x64, 32x96, 64x32）
- 性能监控（FPS、丢帧、队列状态）
- 2D/3D模式切换测试

## 🎨 3D效果展示

### 视觉特性
- **表面渲染**: 平滑的3D曲面，展现压力分布的立体形态
- **底面投影**: 等高线投影到底面，便于位置定位
- **颜色映射**: 与2D保持一致的压力颜色编码
- **透明度**: 适度透明，增强立体感

### 角度设计
- **俯视角**: 15°向上倾斜，保持俯视效果同时增加立体感
- **方位角**: 45°角度，展现数据的三维特征
- **高度缩放**: 0.3倍缩放因子，避免过度拉伸

## ⚠️ 注意事项

### 环境要求
- **Python 3.6+**: 支持f-string和类型提示
- **matplotlib**: 3D绘图支持
- **tkinter**: GUI界面（Windows自带）
- **threading**: 多线程支持

### 性能考虑
- 3D模式比2D模式消耗更多CPU和内存
- 大数组（如96x32）在3D模式下渲染较慢
- 建议在性能较好的机器上使用3D模式

### 使用建议
- 日常检测使用2D模式（高性能）
- 演示讲解使用3D模式（直观立体）
- 长时间运行建议2D模式（节能）

## 🐛 故障排除

### 常见问题

#### 1. 3D模式无响应
```
原因: 渲染线程阻塞
解决: 切换到2D模式，重启应用
```

#### 2. FPS过低
```
原因: 硬件性能不足或数组过大
解决: 降低数组大小或使用2D模式
```

#### 3. 内存占用过高
```
原因: 图形对象未及时释放
解决: 定期重启应用，或切换到2D模式
```

### 调试信息
系统会在控制台输出详细的调试信息：
```
[3D热力图] 渲染线程已启动，目标FPS: 15
[3D热力图] 视角已更新: 仰角=15°, 方位角=45°
[可视化] 切换到3D模式
```

## 📊 性能对比

| 模式 | FPS | CPU占用 | 内存占用 | 响应性 |
|------|-----|---------|----------|--------|
| 2D   | 30+ | 低      | 低       | 优秀   |
| 3D   | 15  | 中等    | 中等     | 良好   |

## 🔮 未来改进

### 计划功能
- [ ] 3D视角的鼠标交互控制
- [ ] 多种3D渲染样式（网格、点云等）
- [ ] 3D动画效果和过渡
- [ ] VR/AR模式支持

### 优化方向
- [ ] GPU加速渲染
- [ ] 更高效的数据传输
- [ ] 自适应质量调整
- [ ] 缓存优化

---

*本功能由Claude Code实现，遵循项目的模块化架构和性能优化原则。*