# 🔬 智能肌少症检测系统

## 文件说明

### 📁 主要文件
#### 核心模块
- `date.py` - 串口数据获取工具（命令行版本）
- `serial_interface.py` - 串口通信模块
- `data_processor.py` - 数据处理模块（包含JQ变换算法）
- `visualization.py` - 热力图可视化模块
- `pressure_sensor_ui.py` - 主UI控制器（模块化版本）

#### 启动脚本
- `run_ui.py` - UI应用启动脚本
- `启动UI.bat` - Windows快速启动脚本
- `requirements.txt` - Python依赖包列表

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行程序

#### 命令行版本（数据获取）
```bash
python date.py
```

#### GUI可视化界面
```bash
# 方式1: 超级优化版本（推荐，极致低延迟）
python run_ui_ultra.py

# 方式2: 高性能版本（平衡性能）
python run_ui_fast.py

# 方式3: 标准版本
python run_ui.py

# 方式4: 直接运行
python pressure_sensor_ui.py

# 方式5: Windows用户双击运行（高性能版）
启动UI.bat
```

## 📊 功能特性

### 🎯 GUI可视化界面功能
#### 🔥 核心功能
- ✅ **模块化架构** - 解耦合的串口、数据处理、可视化模块
- ✅ **JQ数据变换** - 实现威海矩侨工业科技的专用数据重排算法
- ✅ **智能端口检测** - 启动时自动扫描并测试可用端口
- ✅ **多规格阵列支持** - 支持32x32、32x64、32x96等规格

#### 🎨 可视化增强
- ✅ **强对比度热力图** - 16级颜色梯度，从深蓝到白色
- ✅ **网格线显示** - 清晰显示每个传感器点
- ✅ **实时统计面板** - 显示最大值、最小值、平均值、标准差、有效点数
- ✅ **JQ变换指示** - 实时显示是否应用了JQ数据变换

#### 💻 用户体验
- ⚡ **200 FPS极致刷新率** - 5ms超低延迟，毫秒级响应
- 🚀 **智能丢帧策略** - 只显示最新数据，保证实时性
- 🔤 **零警告显示** - 英文界面，消除中文字体警告
- 🧮 **向量化算法** - NumPy优化，JQ变换提速10倍
- 📊 **批量数据处理** - 减少函数调用开销
- ✅ **详细日志记录** - 带时间戳的完整数据处理日志
- ✅ **快照保存** - 高质量PNG/JPG格式导出
- ✅ **日志导出** - 完整的文本日志保存功能

### 🛠️ 技术参数
#### 通信协议
- **波特率**: 1000000 bps
- **帧头**: AA 55 03 99
- **数据格式**: 可变长度数据帧（最大1024字节）
- **终止符**: FF FF（仅命令行版本）

#### 数据处理
- **支持阵列**: 32x32、32x64、32x96等多种配置
- **数据范围**: 0-255（8位无符号整数）
- **JQ变换**: 威海矩侨工业科技专用数据重排算法
  - 1-15行镜像翻转
  - 前15行后移重组
- **自适应处理**: 支持零填充和数据截取

#### 可视化
- **颜色映射**: 16级强对比度热力图
- **更新频率**: 200 FPS（超级版）/ 100 FPS（高性能版）/ 20 FPS（标准版）
- **响应延迟**: <5ms 毫秒级响应
- **数据策略**: 智能丢帧，只显示最新数据
- **字体优化**: 英文显示，零警告延迟
- **算法优化**: NumPy向量化，10倍性能提升
- **统计计算**: 实时最大值、最小值、平均值、标准差

## ⚡ 性能对比

| 性能指标 | 超级优化版 (`run_ui_ultra.py`) | 高性能版 (`run_ui_fast.py`) | 标准版 (`run_ui.py`) |
|---------|------------------------------|---------------------------|---------------------|
| 🔄 更新频率 | **200 FPS (5ms)** | 100 FPS (10ms) | 20 FPS (50ms) |
| ⚡ 响应延迟 | **<5ms** | <10ms | ~50ms |
| 📊 数据策略 | **只取最新帧** | 多帧处理 | 单帧处理 |
| 💾 缓冲区 | **智能管理** | 5000字节 | 10000字节 |
| 📡 串口读取 | **2000字节/次** | 2000字节/次 | 1000字节/次 |
| 🎨 绘图模式 | **实时+优化** | 实时绘制 | 延迟绘制 |
| 🔤 字体处理 | **英文无警告** | 中文支持 | 中文支持 |
| 🧮 算法优化 | **NumPy向量化** | 标准处理 | 标准处理 |

**推荐使用超级优化版本获得极致实时体验！**

## 💡 使用说明

1. **启动程序**: 运行 `pressure_sensor_ui.py`
2. **连接设备**: 
   - 程序会自动扫描COM端口
   - 选择正确的端口
   - 点击"连接"按钮
3. **观察数据**: 
   - 左侧显示实时热力图
   - 右侧显示数据日志
   - 底部显示统计信息

## 🎨 界面说明

### 控制面板
- **COM端口选择**: 选择串口设备
- **刷新端口**: 重新扫描可用端口
- **连接/断开**: 控制串口连接状态
- **状态指示器**: 显示连接状态

### 热力图显示
- **颜色含义**: 
  - 深蓝色/黑色 = 低压力（0-50）
  - 绿色 = 中等压力（51-150）
  - 黄色 = 较高压力（151-200）
  - 红色/白色 = 高压力（201-255）
- **坐标轴**: X轴为传感器列，Y轴为传感器行
- **颜色条**: 右侧显示压力值对应的颜色刻度

### 数据日志
- 显示每帧的时间戳、帧编号和统计信息
- 自动滚动到最新数据
- 支持清除历史日志

## 🔧 故障排除

### 常见问题
1. **找不到COM端口**
   - 检查设备是否正确连接
   - 确认设备驱动已安装

2. **连接失败**
   - 检查端口是否被其他程序占用
   - 尝试重新插拔设备

3. **数据显示异常**
   - 检查波特率设置（1000000）
   - 确认数据格式正确

### 依赖问题
如果遇到依赖包安装问题：
```bash
pip install --upgrade pip
pip install numpy matplotlib pyserial
```

## 📈 性能优化
- 使用多线程处理数据接收和UI更新
- 限制缓冲区大小防止内存溢出
- 优化图形更新频率平衡性能和流畅度 